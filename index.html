<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sohbet</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial, sans-serif;
}
header{
  background:#111;
  padding:15px;
  text-align:center;
  font-weight:bold;
}
#chat{
  height:calc(100vh - 130px);
  overflow-y:auto;
  padding:10px;
}
.msg{
  margin-bottom:10px;
}
.me{ color:#4caf50; text-align:right; }
.other{ color:#03a9f4; text-align:left; }

footer{
  display:flex;
  background:#111;
  padding:10px;
}
input{
  flex:1;
  padding:10px;
  border:none;
  outline:none;
}
button{
  padding:10px;
  background:#4caf50;
  border:none;
  font-weight:bold;
}
</style>
</head>

<body>

<header>ðŸ’¬ CanlÄ± Sohbet</header>

<div id="chat"></div>

<footer>
  <input id="msg" placeholder="Mesaj yaz...">
  <button onclick="send()">GÃ¶nder</button>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let user = localStorage.getItem("user");
if(!user){
  user = prompt("KullanÄ±cÄ± adÄ±n?");
  localStorage.setItem("user", user);
}

const q = query(collection(db,"mesajlar"), orderBy("zaman"));

onSnapshot(q, (snap)=>{
  const chat = document.getElementById("chat");
  chat.innerHTML="";
  snap.forEach(doc=>{
    const d = doc.data();
    const div = document.createElement("div");
    div.className = "msg " + (d.gonderen === user ? "me" : "other");
    div.textContent = d.gonderen + ": " + d.metin;
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
});

window.send = async ()=>{
  const input = document.getElementById("msg");
  if(!input.value) return;
  await addDoc(collection(db,"mesajlar"),{
    gonderen:user,
    metin:input.value,
    zaman:serverTimestamp()
  });
  input.value="";
}
</script>

</body>
</html>