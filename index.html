<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sohbet</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: #fff;
  margin: 0;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

header {
  padding: 10px;
  background: #1f1f1f;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#chat {
  flex: 1;
  padding: 10px;
  overflow-y: auto;
}

.message {
  max-width: 70%;
  margin: 6px 0;
  padding: 8px;
  border-radius: 10px;
  font-size: 14px;
}

.me {
  background: #0a84ff;
  margin-left: auto;
  text-align: right;
}

.other {
  background: #333;
  margin-right: auto;
}

.time {
  font-size: 10px;
  opacity: 0.6;
}

footer {
  display: flex;
  padding: 10px;
  background: #1f1f1f;
}

input {
  flex: 1;
  padding: 8px;
  border-radius: 5px;
  border: none;
}

button {
  margin-left: 5px;
  padding: 8px;
  border-radius: 5px;
  border: none;
  cursor: pointer;
}

.light {
  background: #f5f5f5;
  color: #000;
}

.light header,
.light footer {
  background: #ddd;
}
</style>
</head>

<body>
<header>
  <div id="user"></div>
  <button onclick="toggleTheme()">üåô</button>
</header>

<div id="chat"></div>

<footer>
  <input id="text" placeholder="Mesaj yaz..." />
  <button onclick="send()">‚û§</button>
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "API_KEY",
  authDomain: "PROJECT.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT.appspot.com",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let username = localStorage.getItem("username");
if (!username) {
  username = prompt("Kullanƒ±cƒ± adƒ±n?");
  localStorage.setItem("username", username);
}
document.getElementById("user").innerText = username;

const chat = document.getElementById("chat");

const q = query(collection(db, "mesajlar"), orderBy("zaman"));

onSnapshot(q, (snap) => {
  chat.innerHTML = "";
  snap.forEach(docu => {
    const d = docu.data();
    const div = document.createElement("div");
    div.className = "message " + (d.gonderen === username ? "me" : "other");
    div.innerHTML = `
      <b>${d.gonderen}</b><br>
      ${d.metin}
      <div class="time">${new Date(d.zaman).toLocaleTimeString()}</div>
      ${d.gonderen === username ? `<button onclick="sil('${docu.id}')">üóëÔ∏è</button>` : ""}
    `;
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
});

window.send = async () => {
  const text = document.getElementById("text");
  if (!text.value) return;

  await addDoc(collection(db, "mesajlar"), {
    gonderen: username,
    metin: text.value,
    zaman: Date.now()
  });
  text.value = "";
};

window.sil = async (id) => {
  await deleteDoc(doc(db, "mesajlar", id));
};

window.toggleTheme = () => {
  document.body.classList.toggle("light");
};
</script>
</body>
</html>