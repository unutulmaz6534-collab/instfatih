<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Grup Sohbet</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  serverTimestamp,
  query,
  orderBy,
  onSnapshot,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// ðŸ”¥ Firebase AyarlarÄ±
const firebaseConfig = {
  apiKey: "AIzaSyC4SczNrhYyr_sTPv7gHdNmdCW8fcQEahc",
  authDomain: "instafatih-28213.firebaseapp.com",
  projectId: "instafatih-28213",
  storageBucket: "instafatih-28213.appspot.com",
  messagingSenderId: "885847505120",
  appId: "1:885847505120:web:06e60cf83d229e8a437885"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// ðŸ‘¤ KullanÄ±cÄ± adÄ±
const user = prompt("KullanÄ±cÄ± adÄ±n:");
if (!user) location.reload();

// âœ‰ï¸ Mesaj gÃ¶nder
window.sendMessage = async () => {
  const input = document.getElementById("msg");
  if (!input.value.trim()) return;

  await addDoc(collection(db, "messages"), {
    sender: user,
    text: input.value,
    createdAt: serverTimestamp(),
    readBy: []
  });

  input.value = "";
};

// ðŸ”„ MesajlarÄ± dinle
const q = query(collection(db, "messages"), orderBy("createdAt"));
onSnapshot(q, (snapshot) => {
  const box = document.getElementById("messages");
  box.innerHTML = "";

  snapshot.forEach(async (docSnap) => {
    const m = docSnap.data();
    const div = document.createElement("div");
    div.className = m.sender === user ? "me" : "other";

    // ðŸ‘€ Okundu mantÄ±ÄŸÄ±
    let ticks = "";
    if (m.sender === user) {
      ticks = m.readBy.length > 1 ? "âœ“âœ“" : "âœ“";
    }

    div.innerHTML = `<span><b>${m.sender}:</b> ${m.text}</span><small>${ticks}</small>`;
    box.appendChild(div);

    // MesajÄ± okunduya ekle
    if (!m.readBy.includes(user)) {
      await updateDoc(doc(db, "messages", docSnap.id), {
        readBy: [...m.readBy, user]
      });
    }
  });

  box.scrollTop = box.scrollHeight;
});
</script>

<style>
body {
  background:#f0f2f5;
  font-family:Arial;
}
#chat {
  width:400px;
  margin:40px auto;
  background:white;
  border-radius:10px;
  box-shadow:0 0 10px #ccc;
}
#messages {
  height:350px;
  overflow-y:auto;
  padding:10px;
}
.me { text-align:right; margin:5px; }
.other { text-align:left; margin:5px; }
.me span {
  background:#3797f0;
  color:white;
  padding:6px 10px;
  border-radius:15px;
  display:inline-block;
}
.other span {
  background:#eee;
  padding:6px 10px;
  border-radius:15px;
  display:inline-block;
}
small {
  font-size:10px;
  margin-left:5px;
}
#bottom {
  display:flex;
  border-top:1px solid #ddd;
}
input {
  flex:1;
  padding:10px;
  border:none;
}
button {
  padding:10px;
  background:#3797f0;
  color:white;
  border:none;
}
</style>
</head>

<body>

<div id="chat">
  <div id="messages"></div>
  <div id="bottom">
    <input id="msg" placeholder="Mesaj yaz...">
    <button onclick="sendMessage()">GÃ¶nder</button>
  </div>
</div>

</body>
</html>