<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>InstFatih - Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
.container{max-width:500px;margin:auto;padding:10px}
.post{background:#fff;padding:10px;margin-bottom:10px;border-radius:6px}
img{width:100%}
.like{color:red;cursor:pointer}
.comment{font-size:14px}
</style>
</head>
<body>

<div class="container">
  <input id="url" placeholder="Resim URL">
  <button onclick="share()">Paylaş</button>
  <div id="posts"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4SCzN-hYyr_sTPv7gHdNmdCW8fcQEahc",
  authDomain: "instafatih-28213.firebaseapp.com",
  projectId: "instafatih-28213"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

window.share = async ()=>{
  await addDoc(collection(db,"posts"),{
    url:url.value,
    likes:0,
    comments:[]
  });
  url.value="";
}

onSnapshot(collection(db,"posts"), snap=>{
  posts.innerHTML="";
  snap.forEach(d=>{
    const p=d.data();
    posts.innerHTML+=`
      <div class="post">
        <img src="${p.url}">
        <div class="like" onclick="like('${d.id}')">❤️ ${p.likes}</div>
        <input placeholder="Yorum yaz" onkeydown="if(event.key==='Enter')comment('${d.id}',this.value)">
        ${p.comments.map(c=>`<div class="comment">${c}</div>`).join("")}
      </div>
    `;
  })
})

window.like = async id=>{
  await updateDoc(doc(db,"posts",id),{likes:increment(1)});
}

window.comment = async (id,text)=>{
  await updateDoc(doc(db,"posts",id),{
    comments:arrayUnion(text)
  });
}
</script>
</body>
</html>