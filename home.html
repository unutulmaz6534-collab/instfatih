<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>InstFatih - Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial;
  background:#f2f2f2;
  margin:0;
}
.container{
  max-width:500px;
  margin:auto;
  padding:15px;
}
.post-box{
  background:#fff;
  padding:15px;
  border-radius:8px;
  margin-bottom:15px;
}
input,button{
  width:100%;
  padding:10px;
  margin-bottom:8px;
}
img{
  width:100%;
  border-radius:6px;
}
.like{
  cursor:pointer;
  color:#e74c3c;
  font-size:18px;
}
</style>
</head>
<body>

<div class="container">

  <div class="post-box">
    <input id="imgUrl" placeholder="Resim URL">
    <button onclick="share()">Paylaş</button>
  </div>

  <div id="posts"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4SCzN-hYyr_sTPv7gHdNmdCW8fcQEahc",
  authDomain: "instafatih-28213.firebaseapp.com",
  projectId: "instafatih-28213",
  storageBucket: "instafatih-28213.firebasestorage.app",
  messagingSenderId: "885847505120",
  appId: "1:885847505120:web:06e60cf83d229e84a37885"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.share = async function(){
  const url = document.getElementById("imgUrl").value;
  if(!url) return alert("URL gir");

  await addDoc(collection(db,"posts"),{
    url:url,
    likes:0,
    time:Date.now()
  });

  document.getElementById("imgUrl").value="";
}

const postArea = document.getElementById("posts");

onSnapshot(collection(db,"posts"), snap=>{
  postArea.innerHTML="";
  snap.forEach(docu=>{
    const p = docu.data();
    postArea.innerHTML += `
      <div class="post-box">
        <img src="${p.url}">
        <div class="like" onclick="like('${docu.id}')">
          ❤️ ${p.likes}
        </div>
      </div>
    `;
  });
});

window.like = async function(id){
  const ref = doc(db,"posts",id);
  await updateDoc(ref,{likes:increment(1)});
}
</script>

</body>
</html>