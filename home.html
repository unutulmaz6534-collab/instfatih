<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>InstFatih</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
import {
  getFirestore, collection, addDoc, getDocs,
  updateDoc, doc, arrayUnion, query, orderBy
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC4SCzN-hYyr_sTPv7gHdNmdCW8fcQEahc",
  authDomain: "instafatih-28213.firebaseapp.com",
  projectId: "instafatih-28213",
  storageBucket: "instafatih-28213.firebasestorage.app",
  messagingSenderId: "885847505120",
  appId: "1:885847505120:web:06e60cf83d229e84a37885"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.logout = async () => {
  await signOut(auth);
  location.href = "index.html";
};

window.paylas = async () => {
  const text = postText.value;
  if (!text) return alert("Bir şey yaz");

  await addDoc(collection(db, "posts"), {
    text,
    likes: 0,
    comments: [],
    time: Date.now(),
    user: auth.currentUser.email
  });

  postText.value = "";
  yukle();
};

window.like = async (id, likes) => {
  await updateDoc(doc(db, "posts", id), { likes: likes + 1 });
  yukle();
};

window.comment = async (id) => {
  const c = prompt("Yorum yaz");
  if (!c) return;
  await updateDoc(doc(db, "posts", id), {
    comments: arrayUnion(c)
  });
  yukle();
};

async function yukle() {
  posts.innerHTML = "";
  const q = query(collection(db, "posts"), orderBy("time", "desc"));
  const snap = await getDocs(q);

  snap.forEach(d => {
    const p = d.data();
    posts.innerHTML += `
      <div class="post">
        <b onclick="location.href='profile.html?u=${p.user}'">${p.user}</b>
        <p>${p.text}</p>
        ❤️ ${p.likes}
        <button onclick="like('${d.id}', ${p.likes})">Beğen</button>
        <button onclick="comment('${d.id}')">Yorum</button>
        <div>${(p.comments||[]).join("<br>")}</div>
      </div>
    `;
  });
}

window.onload = yukle;
</script>

<style>
body{font-family:Arial;background:#eee;margin:0}
header{background:#000;color:#fff;padding:10px;display:flex;justify-content:space-between}
.post{background:#fff;margin:10px;padding:10px;border-radius:8px}
textarea,button{width:100%;margin-top:5px}
</style>
</head>

<body>
<header>
<b>InstFatih</b>
<button onclick="logout()">Çıkış</button>
</header>

<div class="post">
<textarea id="postText" placeholder="Ne düşünüyorsun?"></textarea>
<button onclick="paylas()">Paylaş</button>
</div>

<div id="posts"></div>
</body>
</html>